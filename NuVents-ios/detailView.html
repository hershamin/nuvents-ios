<html ng-app="eventDetailApp">
    <title>Event Detail</title>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.21/angular.min.js"></script>
        <script>
            window.setEvent = function(data) {
                try {
                    data = JSON.parse(data)
                } catch (e) {}
                angular.element(document.querySelector("body")).scope().setEvent(data);
            }
            var eventDetailApp = angular.module("eventDetailApp", []);
            eventDetailApp.controller("eventDetailCtrl", function ($scope, $http) {
                $scope.setEvent = function(data) {
                    $scope.$apply(function() {
                        $scope.event = data;
                    })
                }
                $scope.close = function() {
                    window.location = "closeDetailView://";
                }
                $scope.openCalendar = function() {
                    window.location = "openCalendar://";
                }
                $scope.baseURL = "http://storage.googleapis.com/nuvents-resources/event-category-icons/";
                $scope.getDate = function(epoch) {
                    var monthNames = new Array("January", "February", "March",
                                               "April", "May", "June", "July", "August", "September",
                                               "October", "November", "December");
                    var today = new Date(); // Today date
                    var date = new Date(epoch * 1000); // Event date
                    if (today.getFullYear() == date.getFullYear() && today.getMonth() == date.getMonth() && today.getDate() == date.getDate()) {
                        // Today's event
                        return "Today at " + convertTime(date.getHours() + ":" + date.getMinutes())
                    } else if (today.getFullYear() == date.getFullYear() && today.getMonth() == date.getMonth() && today.getDate() == (date.getDate() - 1)) {
                        // Tomorrow's event
                        return "Tomorrow at " + convertTime(date.getHours() + ":" + date.getMinutes())
                    } else {
                        // Other day's event
                        return monthNames[date.getMonth()] + " " + date.getDate() + getDateOrd(date.getDate()) + " at " + convertTime(date.getHours() + ":" + date.getMinutes())
                    }
                }
                var convertTime = function(time) {
                    // Check correct time format and split into components
                    var timeS = time.split(":")
                    hour = parseFloat(timeS[0])
                    min = parseFloat(timeS[1])

                    if (time.indexOf("12:0") > -1) {
                        return "noon"
                    } else if (hour == 0 && min == 0) {
                        return "12 AM"
                    } else if (hour == 0 && min > 0) {
                        return "12:" + min + " AM"
                    } else if (hour < 12 && min == 0) {
                        return hour + " AM"
                    } else if (hour < 12 && min > 0) {
                        return timeS.join(":") + " AM"
                    } else if (hour == 12 && min > 0) {
                        return timeS.join(":") + " PM"
                    } else if (hour > 12 && min == 0) {
                        return (hour - 12) + " PM"
                    } else if (hour > 12 && min > 0) {
                        return (hour - 12) + ":" + min + " PM"
                    } else {
                        return timeS.join(":")
                    }
                }
                var getDateOrd = function(date) {
                    switch(date) {
                        case 1:
                        case 21:
                        case 31:
                            return 'st';
                        case 2:
                        case 22:
                            return 'nd';
                        case 3:
                        case 23:
                            return 'rd';
                        default:
                            return 'th';
                    }
                }
            })
        </script>
        <style>
            html, body {
                height:100%;
                margin: 0;
                padding: 0;
                background: transparent;
            }
            .card {
                background:#FFF;
                opacity:0.8;
                filter:alpha(opacity=80);
                border: 1px solid #AAA;
                border-bottom: 3px solid #BBB;
                padding:0px;
                margin:15px;
                overflow:auto;
            }

            .card h1 {
                font-size: 25px;
                margin: 0px;
                padding:10px;
                padding-bottom:0px;
            }
            .card h2 {
                font-size: 15px;
                margin: 0px;
                padding:10px;
                padding-bottom:0px;
            }

            .card p {
                font-size: 13px;
                margin:0px;
                padding:10px;
            }
            .card-image {
                background-position: cover;
                background-size: 100% 100%;
                padding:0px;
                background-position:center;
                background-repeat:no-repeat;
                position:absolute;
                overflow:auto;
                width: 100%;
                height: 100%;
            }
            }
            #details {
                height: 90%;
                background-size: 100% 100%;
                color: black;
                font-weight: bold;
            }
        </style>
    </head>
    <body ng-controller="eventDetailCtrl">
        <div class="card-image" ng-style="{'background-image':'linear-gradient(rgba(28,60,109,0.1),rgba(28,60,109,0.5)),url(' + event.media + ')'}">
            <div class="card">
                <h1>{{event.title}}<h1>
                    <div class="banner"> </div>
                    <h2>{{event.address}}</h2>
                    <h2>{{getDate(event.time.start)}}<button style="border:0;" type="button" ng-click="openCalendar()"><img src="Calendar-icon.png" height="30px"></button></h2>
                    <p> {{event.description}} </p>
                    <p> <strong>Price:</strong> {{event.price}} </p>
                    </div>
                    </div>


                </body>
            </html>